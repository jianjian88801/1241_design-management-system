<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>
    开题报告
  </title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <link rel="stylesheet" href="../css/main.css" media="all">
    <script type="text/javascript" src="../lib/loading/okLoading.js"></script>
<!--  <link rel="stylesheet" href="../css/bootstrap.css">-->
  <!--导入ElementUI样式列表，css样式一般都在页面头部-->
  <link rel="stylesheet" href="../css/index.css">

  <style>
    .el-button--goon.is-active,
    .el-button--goon:active {
      background: #20B2AA;
      border-color: #20B2AA;
      color: #fff;
    }

    .el-button--goon:focus,
    .el-button--goon:hover {
      background: #48D1CC;
      border-color: #48D1CC;
      color: #fff;
    }

    .el-button--goon {
      color: #FFF;
      background-color: #20B2AA;
      border-color: #20B2AA;
    }



  </style>

</head>
<body>
<div id="app">
  <div class="x-nav">
            <span class="layui-breadcrumb">
              <a><cite>首页</cite></a>
              <a><cite>资料归档</cite></a>
              <a><cite>开题报告</cite></a>
            </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"  href="javascript:location.replace(location.href);" title="刷新"><i class="layui-icon" style="line-height:30px">ဂ</i></a>
  </div>
    <div style="height: 300px;position: absolute;left: 1300px;top: 100px" >
        <el-steps direction="vertical" :active="Opening_report.progress" space='200'>
            <el-step>
                <template slot="description">
                    <span>{{Opening_report.stu_name}}<br>{{Opening_report.sub_time}}</span>
                </template>
            </el-step>
            <el-step description="" style="width: 100px">
                <template slot="description">
                    <span>{{Opening_report.tea_name}}<br>{{Opening_report.suggestions}}</span>
                </template>
            </el-step>
        </el-steps>
    </div>
  <div class="x-body" style="width: 1000px;height: 1800px;position: relative;left: 220px">
<!--    <div>-->
<!--      <el-steps :active="Opening_report.progress" align-center>-->
<!--        <el-step title="学生" :description="Opening_report">-->
<!--          <template slot="description">-->
<!--            <span>{{Opening_report.stu_name}}<br>{{Opening_report.sub_time}}</span>-->
<!--          </template>-->
<!--        </el-step>-->
<!--        <el-step title="指导老师" :description="Opening_report">-->
<!--          <template slot="description">-->
<!--            <span>{{Opening_report.tea_name}}<br>{{Opening_report.appraise}}</span>-->
<!--          </template>-->
<!--        </el-step>-->
<!--      </el-steps>-->
<!--    </div>-->
    <el-descriptions class="margin-top" title="开题报告基本信息" :column="3" size="small" border>
      <template slot="extra">
        <a title="编辑开题报告" @click="AssBook_edit('编辑开题报告','edit_opening_report.html',stuNum,'1000','1000')">
          <el-button type="warning" size="small" :disabled="Opening_report.progress == 2">编辑</el-button>
        </a>
        <a title="下载开题报告" href="/Student/download?fileType=2">
          <el-button type="warning" size="small" >下载开题报告</el-button>
        </a>
      </template>

      <el-descriptions-item>
        <template slot="label">
          <i class="el-icon-s-opportunity"></i>
          标题
        </template>
        {{Opening_report.title}}
      </el-descriptions-item>
      <el-descriptions-item>
        <template slot="label">
          外文标题
        </template>
        {{Opening_report.foreign_title}}
      </el-descriptions-item>
      <el-descriptions-item>
        <template slot="label">
          选题学生
        </template>
        {{Opening_report.stu_name}}
      </el-descriptions-item>
      <el-descriptions-item>
        <template slot="label">

          课题所属部门
        </template>
        {{Opening_report.department}}
      </el-descriptions-item>
      <el-descriptions-item>
        <template slot="label">
          提交时间
        </template>
        {{Opening_report.sub_time}}
      </el-descriptions-item>
      <el-descriptions-item>
        <template slot="label">
          审核时间
        </template>
        {{Opening_report.exam_time}}
      </el-descriptions-item>
    </el-descriptions>

    <el-descriptions class="margin-top" title="开题报告详情" :column="3" :size="size" border style="margin: 10px">
    </el-descriptions>
    <font style="color: red;margin: 20px">1.选题背景和意义</font>
    <br>
    <div v-html="Opening_report.background_and_significance"></div>
    <br>
    <font style="color: red;margin: 20px">2.本选题在国内外的研究状况及发展趋势</font>
    <br>
      <div v-html="Opening_report.development_trend"></div>
    <br>
    <font style="color: red;margin: 20px">3.参考文献</font>
    <br>
      <div v-html="Opening_report.reference"></div>
    <br>
    <font style="color: red;margin: 20px">4.主要设计（研究）内容</font>
    <br>
      <div v-html="Opening_report.content"></div>
    <br>
    <font style="color: red;margin: 20px">5.基本设计（研究）思路及技术关键点</font>
    <br>
      <div v-html="Opening_report.design"></div>

    <br>
    <font style="color: red;margin: 20px">6.预期成果</font>
    <br>
    <div v-html="Opening_report.expected"></div>

<!--    <el-descriptions class="margin-top" title="附件" :column="3" :size="size" border style="margin-top: 10px">-->
<!--    </el-descriptions>-->

<!--    <el-link type="primary" href="/Student/download?fileType=1">{{Opening_report.file_location}}</el-link>-->
  </div>
</div>

<script src="../lib/layui/layui.js" charset="utf-8"></script>
<!--js脚本一般是放在页面尾部-->
<!--Vue js脚本-->
<script src="../js/vue.js" charset="utf-8"></script>
<!--引入ElementUI组件库-->
<script src="../js/index.js" charset="utf-8"></script>
<!--引入Axios js脚本-->
<script src="../js/axios.js" charset="utf-8"></script>
<!--引入时间插件包Momentjs-->
<script src="../js/moment.min.js" charset="utf-8"></script>
<script type="text/javascript">
  var app = new Vue({
    el:"#app",
    data:{

      SessionOptions:{},
      stuNum:"", // 学生学号
      Opening_report:{
        id:'',
        stu_id:'',
        tea_id:'',
        ass_book_id:'',
        title:'',
        foreign_title:'',
        background_and_significance:'',
        development_trend:'',
        reference:'',
        content:'',
        suggestions:'',
        expected:'',
        design:'',
        sub_time:'',
        exam_time:'',
        assignment_book:'',
        File_location:'',
        tea_name:'',
        stu_name:'',
        department:'',
        progress:'',
      },
      jobfile: [{name: '', url: ''}],
      ktfile: [{name: '', url: ''}],
      shufile: [{name: '', url: ''}],
      yifile: [{name: '', url: ''}],
      xgfile: [{name: '', url: ''}],
      chafile: [{name: '', url: ''}],
      bsfile: [{name: '', url: ''}],

      communityList:[],
      DepartOptions:[],
      MajorOptions:[],
      ClassOptions:[],
      rules: {

        name: [
          { required: true, message: '请输入名字', trigger: 'blur' }
        ],
        depart: [
          { required: true, message: '请选择系部', trigger: 'blur' }
        ],
        gender:[
          { required: true, message: '请选择性别', trigger: 'change' }
        ],
        phoneNumber:[
          { required: true, message: '请输入手机号', trigger: 'blur' }
        ],
        session:[
          { required: true, message: '请输入届数', trigger: 'blur' }
        ],
        campus:[
          { required: true, message: '请输入校区', trigger: 'blur' }
        ],
      }
    },
    methods:{
      //查询学生自己的开题报告  函数
      findOpeningReportById(){
        axios.get("/Student/findOpeningReportById").then((res)=>{
          console.log(res.data.data);
          this.Opening_report.title = res.data.data.assignment_book.title;
          this.Opening_report.foreign_title = res.data.data.assignment_book.foreign_title;
          this.Opening_report.department = res.data.data.assignment_book.department;
          this.Opening_report.background_and_significance = res.data.data.background_and_significance;
          this.Opening_report.development_trend = res.data.data.development_trend;
          this.Opening_report.reference = res.data.data.reference;
          this.Opening_report.content = res.data.data.content;
          this.Opening_report.suggestions = res.data.data.suggestions;
          this.Opening_report.expected = res.data.data.expected;
          this.Opening_report.design = res.data.data.design;
          this.Opening_report.sub_time = res.data.data.sub_time;
          this.Opening_report.exam_time = res.data.data.exam_time;
          this.Opening_report.File_location = res.data.data.File_location;
          this.Opening_report.tea_name = res.data.data.tea_name;
          this.Opening_report.stu_name = res.data.data.stu_name;
          this.Opening_report.progress = res.data.data.progress;
        });
      },
      AssBook_edit(title,url,id,w,h){
        url = url+"?id="+id;
        this.x_admin_show(title,url,w,h);
      },

      x_admin_show(title,url,width,height){
        if (title == null || title == '') {
          title=false;
        };
        if (url == null || url == '') {
          url="404.html";
        };
        if (width == null || width == '') {
          width=800;
        };
        if (height == null || height == '') {
          height=($(window).height() - 50);
        };

        layer.open({
          type: 2,
          area: [width+'px', height +'px'],
          fix: false, //不固定
          maxmin: true,
          shadeClose: true,
          shade:0.4,
          title: title,
          content: url,
          cancel: function(index, layero){
            //使用右上角x关闭弹窗层，回调方法，重新加载页面数据，让修改或者新增的数据立马显示在页面上
            app.findOpeningReportById();
          }
        });
      },
      getAllDeptToSelect(){
        axios.get("/Manager/getAllDeptToSelect").then((res)=>{
          this.DepartOptions = res.data.data;
          console.log(this.DepartOptions);
        });
      },
      search(){
          axios.post("/Student/searchAllFileData").then((res)=>{
              // console.log(res.data.data);
              this.stuNum = res.data.data.studentid; //在页面存放学生学号参数
              this.jobfile[0].name = res.data.data.jobfile;
              this.shufile[0].name = res.data.data.shufile;
              this.ktfile[0].name = res.data.data.ktfile;
              this.bsfile[0].name = res.data.data.bsfile;
              this.yifile[0].name = res.data.data.yifile;
              this.chafile[0].name = res.data.data.chafile;
              this.xgfile[0].name = res.data.data.xgfile;
          });
        },
      getMajorsByDepartId(val){//根据系部id获取相应的专业
        console.log(val);
        if(val != null && val != '' && val != undefined){
          axios.get("/Manager/getMajorsByDepId?id="+val)
                  .then(res => {
                    //给MajorOptions数组赋值
                    this.MajorOptions = res.data.data;
                    console.log(this.MajorOptions);
                  })
        }
      },
      getAClassByMajorId(val){//根据专业id获取相应的班级
        console.log(val);
        if(val != null && val != '' && val != undefined){
          axios.get("/Manager/getAClassByMajorId?id="+val+"&session="+this.community.session)
                  .then(res => {
                    //给ClassOptions数组赋值
                    this.ClassOptions = res.data.data;
                    console.log(this.ClassOptions);
                  })
        }
      },
      findById(){
        axios.get("/Manager/findStuById?id="+this.community.id).then((res)=>{
          this.community = res.data.data;
          this.getMajorsByDepartId(this.community.depart.depId);
          this.getAClassByMajorId(this.community.proNumber);
          console.log(this.community);
        });
      },
      handleSuccess(response, file, fileList){
        this.community.thumbnail=response.data;
      },
      // handleRemove() {
      //   axios.get("/estate/delfile?fileName="+this.community.thumbnail).then((res)=>{
      //     app.community.thumbnail="";
      //     if(res.data.flag){
      //       app.fileList=[];
      //       this.$message({
      //         message: '图片删除成功',
      //         type: 'success'
      //       });
      //     }
      //   });
      // },
      handlePreview(file) {
        console.log(file);
      },
      handleExceed(files, fileList) {
        this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);
      },
      //文件删除提示
      beforeRemove(file, fileList) {
        return this.$confirm(`确定移除 ${ file.name }？`);
      },
      //表达重置
      clearAll() {
        this.$refs.communityFormRef.resetFields();
        if(this.fileList.length>0) {
          this.handleRemove();
        }
      },
      save(){
        var method = "";
        if(this.community.id != null){
          method = "update";
          this.community.depart = null;
          this.community.major = null;
        }else{
          method = "add"
        }
        axios.post("/Manager/"+method+"Student",this.community).then((res)=>{
          if(res.data.flag){
            this.$message({
              message: res.data.message,
              type: 'success'
            });
          }
        });
      },
      imgUrl(){
        return "http://localhost/estate"+app.community.thumbnail;
      },
      getQueryString(name){
        let reg = `(^|&)${name}=([^&]*)(&|$)`
        let r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
      }
    },
    created:function(){
      layui.use(['element','layer','form'], function(){
        $ = layui.jquery;//jquery
        lement = layui.element();//面包导航
        layer = layui.layer;//弹出层
        form = layui.form();
        okLoading.close($);
      });
      this.search();
      this.findOpeningReportById();
    }
  });
</script>
</body>

</html>