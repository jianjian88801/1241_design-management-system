<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>
    选题详情
  </title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
<!--  <link rel="stylesheet" href="../css/main.css" media="all">-->
<!--  &lt;!&ndash;  <script type="text/javascript" src="../lib/loading/okLoading.js"></script>&ndash;&gt;-->
<!--  <link rel="stylesheet" href="../css/bootstrap.css">-->
<!--  &lt;!&ndash;导入ElementUI样式列表，css样式一般都在页面头部&ndash;&gt;-->
  <link rel="stylesheet" href="../css/index.css">

  <!--百度编辑器-->
  <script src="../ueditor/ueditor.config.js"></script>
  <script src="../ueditor/ueditor.all.min.js"></script>
  <script src="../ueditor/lang/zh-cn/zh-cn.js"></script>
</head>
<body>
<div id="app" class="form">
  <TABLE width="820" border=0 align="center" cellPadding=0
         cellSpacing=1 bgColor=#b1b3b6>
    <TBODY>
    <TR>
      <TD>
        <TABLE cellSpacing=5 cellPadding=5 width="100%" bgColor=#eeeeee
               border=0>
          <TBODY>
          <TR>
            <TD bgColor=#ffffff>
              <form action="teacher?act=apply_topic_do" method="POST" name="form2" id="form2">
                <TABLE cellSpacing=0 cellPadding=0 width="100%"
                       align=center border=0>
                  <TBODY>
                  <TR>
                    <TD>
                      <TABLE width="100%" border=1 align="center"
                             cellPadding=1 cellSpacing=1 borderColor=#ffffff
                             bgColor=#cccccc>
                        <TBODY>
                        <TR bgColor=#E8F0FF>
                          <TD height="30" colSpan=7>
                            <DIV align=center>
                              <STRONG style='color:#FF6600;font-size:14px;font-family:"微软雅黑"'>[选题申请表]
                              </STRONG>
                            </DIV>
                          </TD>
                        <TR  bgColor=#ffffff  style='font-size:14px;height:30px'>
                          <TD width="100px"  rowspan="5">
                            <div align="center" class="style1">课题情况</div>
                          </TD>
                          <TD width="100px">
                            <div align="center">
                              <span class="style1">题目名称</span>
                            </div>
                          </TD>
                          <TD colspan="5">
                            &nbsp;&nbsp;{{community.title}}
                          </TD>
                        </TR>
                        <TR bgColor=#ffffff  style="height:30px">
                          <TD >
                            <div align="center">
                              <span class="style1">选题类别</span>
                            </div>
                          </TD>
                          <TD colspan="5" style='font-size:14px;font-family:"微软雅黑"'>
                            &nbsp;&nbsp;{{community.cate}}

                          </TD>
                        </TR>
                        <TR bgColor=#ffffff style='font-size:14px;font-family:"微软雅黑";height:30px'>
                          <TD >
                            <div align="center">
                              <span >教师姓名</span>

                            </div>
                          </TD>
                          <TD colspan="1" width="120px" >
                            <div align="center" style="" >{{community.teacher.teaName}}</div>
                          </TD>
                          <TD>
                            <div align="center" >
                              <span >职称</span>
                            </div>
                          </TD>
                          <TD width="120px">
                            <div align="center" >{{community.teacher.jobTitle}}</div>
                          </TD>
                          <TD width="80px" >
                            <div align="center">
                              <span>学位</span>
                            </div>
                          </TD>
                          <TD colspan="1"  width="120px">
                            <div align="center" >{{community.teacher.xueWei}}</div>
                          </TD>
                        </TR>
                        <TR bgColor=#ffffff style='font-size:14px;height:30px'>
                          <TD >
                            <div align="center">
                              <span class="style1">课题来源</span>
                            </div>
                          </TD>
                          <TD colspan="5" style='font-size:14px;font-family:"微软雅黑"'>
                            &nbsp;&nbsp;{{community.source}}

                          </TD>
                        </TR>
                        <TR bgColor=#ffffff style='font-size:14px;height:30px'>
                          <TD >
                            <div align="center">
                              <span class="style1">成果类别</span>
                            </div>
                          </TD>
                          <TD colspan="5" style='font-size:14px;font-family:"微软雅黑"'>
                            &nbsp;&nbsp;{{community.type}}
                          </TD>
                        </TR>
                        <TR  bgColor=#ffffff height="500">
                          <TD width="100px" rowspan="1">
                            <div align="center" style='font-size:14px;font-family:"微软雅黑"'>主要研究<br/>内容目标</div>
                          </TD>
                          <TD colspan="6" style="padding:15px">
                            <div v-html="content"></div>
                          </TD>
                        </TR>

                        <TR  bgColor=#ffffff>
                          <TD height="30" width="100px" rowspan="1">
                            <div align="center" style='font-size:14px;font-family:"微软雅黑"'>限选专业</div>
                          </TD>

                          <TD colspan="10">
                            <div align="left" style='padding-left:10px;font-size:14px;'>
                              <div align="left" style='padding-left:10px;font-size:14px;'>
                                <el-tag
                                        size="small"
                                        v-for="tag in community.topic_majors"
                                        :key="tag.major.majorName"
                                >
                                  {{tag.major.majorName}}
                                </el-tag>
                              </div>
                            </div>
                          </TD>

                        </TR>
                        <TR bgColor=#ffffff>
                          <TD  colspan="10" style="text-align:center;height:60px">

                            <table border="0" style="width:340px" align="center">
                              <tr>
                                <td><img style='width:30px' src="../images/luqu.png"/></td>
                                <td><div style='font-size:16px;position: relative;left: -30px' >录取学生:{{community.student.major.majorName}} <b style='color:red'>{{community.student.stuName}}</b></div></td>
                              </tr>
                            </table>
                          </TD>
                        </TR>
                        </TBODY>
                      </TABLE>
                    </TD>
                  </TR>
                  </TBODY>
                </TABLE>
              </form>
            </TD>
          </TR>
          </TBODY>
        </TABLE>
      </TD>
    </TR>
    </TBODY>
  </TABLE>
</div>
<script src="../lib/layui/layui.js" charset="utf-8"></script>
<!--js脚本一般是放在页面尾部-->
<!--Vue js脚本-->
<script src="../js/vue.js" charset="utf-8"></script>
<!--引入ElementUI组件库-->
<script src="../js/index.js" charset="utf-8"></script>
<!--引入Axios js脚本-->
<script src="../js/axios.js" charset="utf-8"></script>
<!--引入时间插件包Momentjs-->
<script src="../js/moment.min.js" charset="utf-8"></script>
<script type="text/javascript">
  var app = new Vue({
    el:"#app",
    data:{
      title:"添加学生",
      SessionOptions:{},
      // community:{id:"",stuDepartId:"",stuName:"",depart:{depId:""}},
      community:{id:"",StuNumber:"", StuName:"", StuDepartId:"", ProNumber:"", StuClass:"", phoneNumber:"", campus:"", gender:"", session:"", state:""},
      fileList:[],
      DepartOptions:[],
      MajorOptions:[],
      ClassOptions:[],
      content:"",
      rules: {

        name: [
          { required: true, message: '请输入名字', trigger: 'blur' }
        ],
        depart: [
          { required: true, message: '请选择系部', trigger: 'blur' }
        ],
        gender:[
          { required: true, message: '请选择性别', trigger: 'change' }
        ],
        phoneNumber:[
          { required: true, message: '请输入手机号', trigger: 'blur' }
        ],
        session:[
          { required: true, message: '请输入届数', trigger: 'blur' }
        ],
        campus:[
          { required: true, message: '请输入校区', trigger: 'blur' }
        ],
      }
    },
    methods:{
      getAllDeptToSelect(){
        axios.get("/Manager/getAllDeptToSelect").then((res)=>{
          this.DepartOptions = res.data.data;
          console.log(this.DepartOptions);
        });
      },
      getMajorsByDepartId(val){//根据系部id获取相应的专业
        console.log(val);
        if(val != null && val != '' && val != undefined){
          axios.get("/Manager/getMajorsByDepId?id="+val)
                  .then(res => {
                    //给MajorOptions数组赋值
                    this.MajorOptions = res.data.data;
                    console.log(this.MajorOptions);
                  })
        }
      },
      getAClassByMajorId(val){//根据专业id获取相应的班级
        console.log(val);
        if(val != null && val != '' && val != undefined){
          axios.get("/Manager/getAClassByMajorId?id="+val+"&session="+this.community.session)
                  .then(res => {
                    //给ClassOptions数组赋值
                    this.ClassOptions = res.data.data;
                    console.log(this.ClassOptions);
                  })
        }
      },
      findById(){
        axios.get("/Student/findTopicById?id="+this.community.id).then((res)=>{
          this.community = res.data.data;
          this.content = this.community.content;
          console.log(this.community);
        });
      },
      handleSuccess(response, file, fileList){
        this.community.thumbnail=response.data;
      },
      handleRemove() {
        axios.get("/estate/delfile?fileName="+this.community.thumbnail).then((res)=>{
          app.community.thumbnail="";
          if(res.data.flag){
            app.fileList=[];
            this.$message({
              message: '图片删除成功',
              type: 'success'
            });
          }
        });
      },
      handlePreview(file) {
        console.log(file);
      },
      handleExceed(files, fileList) {
        this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);
      },
      //文件删除提示
      beforeRemove(file, fileList) {
        return this.$confirm(`确定移除 ${ file.name }？`);
      },
      //表达重置
      clearAll() {
        this.$refs.communityFormRef.resetFields();
        if(this.fileList.length>0) {
          this.handleRemove();
        }
      },
      save(){
        var method = "";
        if(this.community.id != null){
          method = "update";
          this.community.depart = null;
          this.community.major = null;
        }else{
          method = "add"
        }
        axios.post("/Manager/"+method+"Student",this.community).then((res)=>{
          if(res.data.flag){
            this.$message({
              message: res.data.message,
              type: 'success'
            });
          }
        });
      },
      imgUrl(){
        return "http://localhost/estate"+app.community.thumbnail;
      },
      getQueryString(name){
        let reg = `(^|&)${name}=([^&]*)(&|$)`
        let r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
      }
    },
    created:function(){
      layui.use(['element','layer','form'], function(){
        $ = layui.jquery;//jquery
        lement = layui.element();//面包导航
        layer = layui.layer;//弹出层
        form = layui.form();
        okLoading.close($);
      });
      //获取父页面传递参数，小区ID
      this.community.id = this.getQueryString("id");
      //根据小区ID获取小区对象，进行数据回显
      if(this.community.id != null && this.community.id != ''){
        this.title="修改学生";
        this.findById();
      }
      for (let i = 0; i <100; i++) {
        this.SessionOptions[i] = 2001+i;
      }
    }
  });
</script>
</body>
</html>